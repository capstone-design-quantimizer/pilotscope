# PilotScope ìš´ì˜ ë°ì´í„° ê¸°ë°˜ ìµœì í™” - êµ¬í˜„ ìš”ì•½

## ğŸ¯ ëª©í‘œ ë° ë‹¬ì„± í˜„í™©

### ìš”êµ¬ì‚¬í•­ ë‹¬ì„±ë„

| # | ìš”êµ¬ì‚¬í•­ | í˜„ì¬ ìƒíƒœ | í•„ìš”í•œ ì‘ì—… |
|---|---------|----------|------------|
| 1 | Best config ì¶œë ¥ ë° ì„±ëŠ¥ ì¸¡ì • ë°ì´í„° | âœ… 50% | Config Sweep ê¸°ëŠ¥ ì¶”ê°€ í•„ìš” |
| 2 | Dataset/Algorithm ì‰½ê²Œ ë³€ê²½ | âœ… 80% | `unified_test.py` êµ¬í˜„ ì™„ë£Œ |
| 3 | ì„ì˜ì˜ ë°ì´í„°ì…‹ ì¶”ê°€ | âœ… 100% | ê°€ì´ë“œ ë° ìŠ¤í¬ë¦½íŠ¸ ì œê³µ |
| 4 | ëª¨ë¸ Training Dataset ë³€ê²½ | âš ï¸ 10% | PresetScheduler ìˆ˜ì • í•„ìš” |

---

## ğŸ“‚ ìƒì„±ëœ íŒŒì¼ ëª©ë¡

### 1. ë¬¸ì„œ (Documentation)

| íŒŒì¼ | ì„¤ëª… | ìš°ì„ ìˆœìœ„ |
|-----|------|---------|
| `ìš´ì˜_ë°ì´í„°_ê¸°ë°˜_ìµœì í™”_ê°€ì´ë“œ.md` | ì „ì²´ ì•„í‚¤í…ì²˜ ë° êµ¬í˜„ ê°€ì´ë“œ | â­â­â­â­â­ |
| `ë¹ ë¥¸_ì‹œì‘_ê°€ì´ë“œ.md` | 5ë‹¨ê³„ ë¹ ë¥¸ ì‹œì‘ ê°€ì´ë“œ | â­â­â­â­â­ |
| `êµ¬í˜„_ìš”ì•½.md` | ì´ ë¬¸ì„œ | â­â­â­ |

### 2. ìŠ¤í¬ë¦½íŠ¸ (Scripts)

| íŒŒì¼ | ì„¤ëª… | êµ¬í˜„ ìƒíƒœ |
|-----|------|----------|
| `scripts/extract_queries_from_log.py` | PostgreSQL ë¡œê·¸ì—ì„œ SQL ì¶”ì¶œ | âœ… ì™„ë£Œ |
| `test_example_algorithms/unified_test.py` | í†µí•© í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ | âœ… ì™„ë£Œ |

### 3. ì„¤ì • íŒŒì¼ (Config)

| íŒŒì¼ | ì„¤ëª… | êµ¬í˜„ ìƒíƒœ |
|-----|------|----------|
| `test_configs/production_experiment.json` | ì‹¤í—˜ ì„¤ì • ì˜ˆì œ | âœ… ì™„ë£Œ |

### 4. ì•„ì§ ìƒì„±ë˜ì§€ ì•Šì€ íŒŒì¼ (TODO)

| íŒŒì¼ | ì„¤ëª… | ìš°ì„ ìˆœìœ„ |
|-----|------|---------|
| `pilotscope/Dataset/ProductionDataset.py` | ìš´ì˜ ë°ì´í„°ì…‹ í´ë˜ìŠ¤ | ğŸ”´ ë†’ìŒ |
| `algorithm_examples/config_sweep.py` | Config íŒŒë¼ë¯¸í„° ìë™ íƒìƒ‰ | ğŸŸ¡ ì¤‘ê°„ |
| `algorithm_examples/config_grid.py` | ConfigGrid í´ë˜ìŠ¤ | ğŸŸ¡ ì¤‘ê°„ |

---

## ğŸ”¨ êµ¬í˜„ì´ í•„ìš”í•œ í•­ëª©

### Priority 1: ìš´ì˜ ë°ì´í„° ê¸°ë³¸ ì‚¬ìš© (1-2ì‹œê°„)

#### 1-1. ProductionDataset í´ë˜ìŠ¤ ìƒì„±
**íŒŒì¼**: `pilotscope/Dataset/ProductionDataset.py`

```python
from pilotscope.Dataset.BaseDataset import BaseDataset
from pilotscope.PilotEnum import DatabaseEnum

class ProductionDataset(BaseDataset):
    sub_dir = "Production"
    train_sql_file = "production_train.txt"
    test_sql_file = "production_test.txt"
    file_db_type = DatabaseEnum.POSTGRESQL
    
    def __init__(self, use_db_type: DatabaseEnum, created_db_name="production_db"):
        super().__init__(use_db_type, created_db_name)
        self.download_urls = None
```

#### 1-2. utils.py ìˆ˜ì •
**íŒŒì¼**: `algorithm_examples/utils.py`

**ì¶”ê°€í•  ì½”ë“œ** (2ê³³):
```python
# 1. Import ì¶”ê°€ (íŒŒì¼ ìƒë‹¨)
from pilotscope.Dataset.ProductionDataset import ProductionDataset

# 2. load_test_sql() í•¨ìˆ˜ ìˆ˜ì • (36ë²ˆì§¸ ì¤„ ê·¼ì²˜)
def load_test_sql(db):
    # ... ê¸°ì¡´ ì½”ë“œ ...
    elif "production" == db.lower():
        return ProductionDataset(DatabaseEnum.POSTGRESQL).read_test_sql()
    else:
        raise NotImplementedError

# 3. load_training_sql() í•¨ìˆ˜ ìˆ˜ì • (23ë²ˆì§¸ ì¤„ ê·¼ì²˜)
def load_training_sql(db):
    # ... ê¸°ì¡´ ì½”ë“œ ...
    elif "production" == db.lower():
        return ProductionDataset(DatabaseEnum.POSTGRESQL).read_train_sql()
    else:
        raise NotImplementedError
```

---

### Priority 2: Training Dataset ë³€ê²½ ê¸°ëŠ¥ (2-3ì‹œê°„)

#### 2-1. MscnPresetScheduler ìˆ˜ì •
**íŒŒì¼**: `algorithm_examples/Mscn/MscnPresetScheduler.py`

**ìˆ˜ì • ë‚´ìš©**:
```python
def get_mscn_preset_scheduler(config, enable_collection, enable_training, 
                             num_collection=-1, num_training=-1, num_epoch=100,
                             training_dataset="auto"):  # ì¶”ê°€!
    """
    Args:
        training_dataset: í•™ìŠµì— ì‚¬ìš©í•  ë°ì´í„°ì…‹
          - "auto": config.dbì™€ ë™ì¼ (ê¸°ë³¸ê°’)
          - "stats_tiny", "imdb", "production" ë“±: ì§€ì •í•œ ë°ì´í„°ì…‹
    """
    # ... ê¸°ì¡´ ì½”ë“œ ...
    
    pretraining_event = MscnPretrainingModelEvent(
        config, mscn_pilot_model, pretrain_data_save_table,
        enable_collection=enable_collection,
        enable_training=enable_training,
        training_data_file=None,
        num_collection=num_collection,
        num_training=num_training,
        num_epoch=num_epoch,
        training_dataset=training_dataset  # ì „ë‹¬!
    )
    # ...
```

#### 2-2. MscnPretrainingModelEvent ìˆ˜ì •
**íŒŒì¼**: `algorithm_examples/Mscn/EventImplement.py`

**ìˆ˜ì • ë‚´ìš©**:
```python
class MscnPretrainingModelEvent(PretrainingModelEvent):
    def __init__(self, config, bind_pilot_model, data_saving_table,
                 enable_collection=True, enable_training=True,
                 training_data_file=None, num_collection=-1, 
                 num_training=-1, num_epoch=100,
                 training_dataset="auto"):  # ì¶”ê°€!
        super().__init__(config, bind_pilot_model, data_saving_table,
                        enable_collection, enable_training)
        # ... ê¸°ì¡´ ì½”ë“œ ...
        self.training_dataset = training_dataset
    
    def iterative_data_collection(self, db_controller, train_data_manager):
        print("start to collect data for MSCN algorithms")
        
        # í•™ìŠµ ë°ì´í„°ì…‹ ê²°ì • (ì¶”ê°€!)
        if self.training_dataset == "auto":
            dataset_name = self.config.db
        else:
            dataset_name = self.training_dataset
            print(f"Using custom training dataset: {dataset_name}")
        
        self.sqls = load_training_sql(dataset_name)  # ìˆ˜ì •!
        # ... ë‚˜ë¨¸ì§€ ê¸°ì¡´ ì½”ë“œ ìœ ì§€ ...
```

**ë™ì¼í•œ ìˆ˜ì •ì„ Leroì—ë„ ì ìš©**:
- `algorithm_examples/Lero/LeroPresetScheduler.py`
- `algorithm_examples/Lero/EventImplement.py`

---

### Priority 3: Config Sweep ê¸°ëŠ¥ (4-5ì‹œê°„)

#### 3-1. ConfigGrid í´ë˜ìŠ¤
**ìƒˆ íŒŒì¼**: `algorithm_examples/config_grid.py`

```python
"""
Config íŒŒë¼ë¯¸í„° ê·¸ë¦¬ë“œ ìƒì„± ë° ê´€ë¦¬
"""

from itertools import product
from typing import Dict, List

class ConfigGrid:
    """
    ì—¬ëŸ¬ íŒŒë¼ë¯¸í„° ì¡°í•©ì„ ìƒì„±
    
    Example:
        grid = ConfigGrid({
            "num_epoch": [50, 100, 200],
            "num_training": [100, 500, 1000]
        })
        
        for config in grid:
            print(config)
            # {"num_epoch": 50, "num_training": 100}
            # {"num_epoch": 50, "num_training": 500}
            # ...
    """
    
    def __init__(self, param_dict: Dict[str, List]):
        self.param_dict = param_dict
        self.param_names = list(param_dict.keys())
        self.param_values = list(param_dict.values())
    
    def __iter__(self):
        for values in product(*self.param_values):
            yield dict(zip(self.param_names, values))
    
    def __len__(self):
        total = 1
        for values in self.param_values:
            total *= len(values)
        return total
```

#### 3-2. Config Sweep ì‹¤í–‰ê¸°
**ìƒˆ íŒŒì¼**: `algorithm_examples/config_sweep.py`

```python
"""
ì—¬ëŸ¬ Config ì¡°í•©ì„ ìë™ìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•˜ê³  ìµœì  Config ì„ íƒ

ì‚¬ìš©ë²•:
    python config_sweep.py \
        --algo mscn \
        --db production \
        --param num_epoch 50 100 200 \
        --param num_training 100 500 1000
"""

import sys
sys.path.append("../")

import argparse
import json
from pathlib import Path

from pilotscope.PilotConfig import PostgreSQLConfig
from pilotscope.Common.Util import pilotscope_exit
from algorithm_examples.config_grid import ConfigGrid
from algorithm_examples.utils import save_test_result, load_test_results
from test_example_algorithms.unified_test import run_single_test, ALGORITHM_REGISTRY


def run_config_sweep(algo_name: str, dataset_name: str, 
                     config_grid: Dict, db_config: PostgreSQLConfig) -> Dict:
    """
    ì—¬ëŸ¬ config ì¡°í•© í…ŒìŠ¤íŠ¸ ë° ìµœì ê°’ ì„ íƒ
    """
    grid = ConfigGrid(config_grid)
    results = []
    
    print(f"\nğŸ” Config Sweep: Testing {len(grid)} configurations")
    print("=" * 60)
    
    for i, params in enumerate(grid, 1):
        print(f"\n[{i}/{len(grid)}] Testing config: {params}")
        
        try:
            result = run_single_test(db_config, algo_name, dataset_name, params)
            if result:
                results.append(result)
        except Exception as e:
            print(f"âŒ Config failed: {e}")
        finally:
            pilotscope_exit()
    
    # ìµœì  config ì„ íƒ
    if not results:
        print("\nâŒ No successful results")
        return None
    
    best_result = min(results, key=lambda x: x["elapsed_time"])
    
    print("\n" + "=" * 60)
    print("ğŸ† Best Configuration Found!")
    print("=" * 60)
    print(f"Algorithm: {best_result['algorithm']}")
    print(f"Dataset:   {best_result['dataset']}")
    print(f"Time:      {best_result['elapsed_time']:.2f}s")
    print(f"Params:    {best_result['params']}")
    print("=" * 60)
    
    # ê²°ê³¼ ì €ì¥
    sweep_result_file = Path("results") / f"sweep_{algo_name}_{dataset_name}.json"
    with open(sweep_result_file, 'w') as f:
        json.dump({
            "best_config": best_result,
            "all_results": results
        }, f, indent=2)
    
    print(f"\nğŸ’¾ Sweep results saved: {sweep_result_file}")
    
    return best_result


def main():
    parser = argparse.ArgumentParser(description='Config parameter sweep')
    parser.add_argument('--algo', required=True, help='Algorithm name')
    parser.add_argument('--db', required=True, help='Dataset name')
    parser.add_argument('--param', nargs='+', action='append',
                       help='Parameter grid: --param num_epoch 50 100 200')
    
    args = parser.parse_args()
    
    # Config grid íŒŒì‹±
    config_grid = {}
    if args.param:
        for param_spec in args.param:
            param_name = param_spec[0]
            param_values = [int(v) if v.isdigit() else v for v in param_spec[1:]]
            config_grid[param_name] = param_values
    
    # DB Config
    db_config = PostgreSQLConfig()
    db_config.db = args.db
    
    # Sweep ì‹¤í–‰
    run_config_sweep(args.algo, args.db, config_grid, db_config)


if __name__ == '__main__':
    main()
```

---

## ğŸš€ ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: ë¹ ë¥¸ ì‹œì‘ (30ë¶„)

```bash
# 1. ë¡œê·¸ ì¶”ì¶œ
python scripts/extract_queries_from_log.py \
    --input /var/log/postgresql/postgresql.log \
    --output pilotscope/Dataset/Production/

# 2. ProductionDataset í´ë˜ìŠ¤ ìƒì„± (ìœ„ Priority 1 ì°¸ê³ )

# 3. utils.py ìˆ˜ì •

# 4. í…ŒìŠ¤íŠ¸ ì‹¤í–‰
cd test_example_algorithms
python unified_test.py --algo baseline mscn --db production --compare
```

### ì‹œë‚˜ë¦¬ì˜¤ 2: Cross-Dataset Training (1ì‹œê°„)

```bash
# Priority 2 êµ¬í˜„ ì™„ë£Œ í›„

# IMDBë¡œ í•™ìŠµ â†’ ìš´ì˜ DB í…ŒìŠ¤íŠ¸
python test_cross_dataset_training.py
```

### ì‹œë‚˜ë¦¬ì˜¤ 3: ìµœì  Config ì°¾ê¸° (2-3ì‹œê°„)

```bash
# Priority 3 êµ¬í˜„ ì™„ë£Œ í›„

# Config sweep ì‹¤í–‰
python algorithm_examples/config_sweep.py \
    --algo mscn \
    --db production \
    --param num_epoch 50 100 200 \
    --param num_training 100 500 1000 \
    --param num_collection 100 500 1000

# ê²°ê³¼ í™•ì¸
cat results/sweep_mscn_production.json
```

---

## ğŸ“Š ì˜ˆìƒ ê²°ê³¼

### ê¸°ë³¸ í…ŒìŠ¤íŠ¸ (Baseline vs MSCN)

```
============================================================
Comparison Results (total_time):
============================================================
  mscn           :    45.2341s  (33% ê°œì„ )
  baseline       :    67.8912s
============================================================
```

### Config Sweep ê²°ê³¼

```json
{
  "best_config": {
    "algorithm": "mscn",
    "params": {
      "num_epoch": 100,
      "num_training": 500,
      "num_collection": 500
    },
    "elapsed_time": 42.15
  }
}
```

---

## âš¡ ë‹¤ìŒ ë‹¨ê³„ ë¡œë“œë§µ

### Phase 1: ê¸°ë³¸ ê¸°ëŠ¥ (1ì£¼) âœ…
- [x] ë¬¸ì„œ ì‘ì„±
- [x] ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±
- [x] í†µí•© í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬

### Phase 2: ìš´ì˜ ë°ì´í„° ì§€ì› (2ì¼)
- [ ] ProductionDataset í´ë˜ìŠ¤ êµ¬í˜„
- [ ] utils.py ìˆ˜ì •
- [ ] í…ŒìŠ¤íŠ¸ ë° ê²€ì¦

### Phase 3: Training Dataset ìœ ì—°í™” (1ì£¼)
- [ ] PresetScheduler ìˆ˜ì • (Mscn, Lero)
- [ ] EventImplement ìˆ˜ì •
- [ ] Cross-dataset training í…ŒìŠ¤íŠ¸

### Phase 4: Config ìµœì í™” (1ì£¼)
- [ ] ConfigGrid êµ¬í˜„
- [ ] Config Sweep êµ¬í˜„
- [ ] ì‹œê°í™” ì¶”ê°€

### Phase 5: í”„ë¡œë•ì…˜ ì ìš© (1ì£¼)
- [ ] ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬
- [ ] ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ
- [ ] ìš´ì˜ ê°€ì´ë“œ ë¬¸ì„œ

---

## ğŸ“ í•™ìŠµ ìë£Œ

### ê¸°ë³¸ ê°œë…
1. **PilotScope ì•„í‚¤í…ì²˜**: `ìš´ì˜_ë°ì´í„°_ê¸°ë°˜_ìµœì í™”_ê°€ì´ë“œ.md` ì„¹ì…˜ 1
2. **ë°ì´í„° íë¦„**: `ìš´ì˜_ë°ì´í„°_ê¸°ë°˜_ìµœì í™”_ê°€ì´ë“œ.md` ë¶€ë¡ A

### ì‹¤ìŠµ
1. **ë¹ ë¥¸ ì‹œì‘**: `ë¹ ë¥¸_ì‹œì‘_ê°€ì´ë“œ.md`
2. **ì»¤ìŠ¤í…€ ë°ì´í„°ì…‹**: `algorithm_examples/CUSTOM_DATASET_GUIDE.md`
3. **ê²°ê³¼ ê´€ë¦¬**: `algorithm_examples/README_RESULTS.md`

### ì°¸ê³ 
1. **PilotScope ë…¼ë¬¸**: `paper/PilotScope.pdf`
2. **API ë¬¸ì„œ**: https://woodybryant.github.io/PilotScopeDoc.io/

---

## ğŸ’¬ FAQ

### Q1: ê¸°ì¡´ í…ŒìŠ¤íŠ¸ ì½”ë“œì™€ ì–´ë–»ê²Œ ë‹¤ë¥¸ê°€ìš”?
**A**: ê¸°ì¡´ í…ŒìŠ¤íŠ¸ëŠ” ê°œë³„ ì•Œê³ ë¦¬ì¦˜ë§Œ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤. `unified_test.py`ëŠ” ì—¬ëŸ¬ ì•Œê³ ë¦¬ì¦˜ì„ í•œ ë²ˆì— ë¹„êµí•˜ê³ , JSON configë¡œ ì‹¤í—˜ì„ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Q2: ìš´ì˜ DBì— ì˜í–¥ì„ ì£¼ë‚˜ìš”?
**A**: PilotScopeëŠ” ì½ê¸° ì „ìš©ìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤. ì¹´ë””ë„ë¦¬í‹° ì˜ˆì¸¡ì€ ì¿¼ë¦¬ í”Œë˜ë„ˆì—ë§Œ ì˜í–¥ì„ ì£¼ê³  ì‹¤ì œ ë°ì´í„°ëŠ” ë³€ê²½í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ë¶€í•˜ê°€ ë°œìƒí•˜ë¯€ë¡œ í”¼í¬ íƒ€ì„ì„ í”¼í•´ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”.

### Q3: GPUê°€ í•„ìš”í•œê°€ìš”?
**A**: ì„ íƒì‚¬í•­ì…ë‹ˆë‹¤. CPUë¡œë„ ì‘ë™í•˜ì§€ë§Œ, LeroëŠ” GPUë¥¼ ì‚¬ìš©í•˜ë©´ í•™ìŠµ ì†ë„ê°€ 10ë°° ì´ìƒ ë¹¨ë¼ì§‘ë‹ˆë‹¤.

### Q4: ì–¼ë§ˆë‚˜ ë§ì€ ë°ì´í„°ê°€ í•„ìš”í•œê°€ìš”?
**A**: 
- ìµœì†Œ: 100ê°œ ì¿¼ë¦¬ (í”„ë¡œí† íƒ€ì…)
- ê¶Œì¥: 500-1000ê°œ ì¿¼ë¦¬ (ì‹¤í—˜)
- í”„ë¡œë•ì…˜: 1000ê°œ ì´ìƒ (ì‹¤ì „)

### Q5: ê²°ê³¼ë¥¼ ì–´ë–»ê²Œ í•´ì„í•˜ë‚˜ìš”?
**A**: 
- **total_time ê°ì†Œ**: ì¿¼ë¦¬ ìµœì í™” ì„±ê³µ
- **í‰ê·  10-30% ê°œì„ **: ì¼ë°˜ì ì¸ ê²°ê³¼
- **50% ì´ìƒ ê°œì„ **: ë§¤ìš° ì¢‹ì€ ê²°ê³¼ (ë³µì¡í•œ JOINì´ ë§ì€ ê²½ìš°)

---

## ğŸ“ ì§€ì›

- **ì´ìŠˆ**: GitHub Issues
- **ë¬¸ì„œ**: ì´ ë””ë ‰í† ë¦¬ì˜ ë§ˆí¬ë‹¤ìš´ íŒŒì¼ë“¤
- **ì˜ˆì œ**: `test_example_algorithms/` ë””ë ‰í† ë¦¬

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2024ë…„ (ë¬¸ì„œ ìƒì„± ì‹œì )
**ì‘ì„±ì**: AI Assistant
**ë²„ì „**: 1.0

